<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Phone Shop - Trang Chủ</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Biến màu chủ đạo */
        :root {
            --primary-red: #d70018;
            --hover-red: #b30014;
            --light-bg: #f8f9fa;
        }

        body { background-color: var(--light-bg); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* AppBar Custom */
        .navbar {
            background: linear-gradient(to bottom, #e07272 0%, #cd0418 100%);
            border-bottom: 2px solid var(--primary-red);
            padding: 10px 0;
        }
        .navbar-brand { color: white; }
        .navbar-brand:hover {
            color: white;
        }
        
        /* --- PHẦN FIX: THANH TÌM KIẾM --- */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 500px;
        }
        .search-input {
            border-radius: 8px ; /* Bo tròn ô nhập liệu */
            padding-right: 50px; /* Tạo khoảng trống bên phải cho nút bấm */
            border: none;
            height: 40px;
        }
        .search-btn-inside {
            position: absolute;
            right: 5px; /* Cách lề phải 5px */
            top: 50%;
            transform: translateY(-50%); /* Căn giữa theo chiều dọc */
            background-color: var(--primary-red);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
            z-index: 10;
            border-radius: 8px;
            width: 12%;
        }
        .search-btn-inside:hover {
            opacity: 0.8;
        }
        /* ------------------------------- */

        /* Button styles cho navbar */
        .navbar .btn-primary { 
            background-color: white; 
            border-color: white;
            color: var(--primary-red);
            font-weight: 600;
        }
        .navbar .btn-primary:hover { 
            opacity: 0.8;
        }
        .navbar .btn-outline-primary { 
            color: white; 
            border-color: white;
            font-weight: 600;
            background-color: rgb(183, 13, 13);
        }
        .navbar .btn-outline-primary:hover { 
            background-color: white; 
            color: var(--primary-red);
            border-color: white;
        }

        /* Card Thương hiệu */
        .brand-card {
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        .brand-card img {
            max-height: 40px;
            max-width: 100%;
            filter: grayscale(100%);
            transition: 0.3s;
        }
        .brand-card:hover {
            box-shadow: 0 5px 15px rgba(215, 0, 24, 0.15);
            border-color: var(--primary-red);
            transform: translateY(-3px);
        }
        .brand-card:hover img { filter: grayscale(0%); }
        
        /* Card Sản phẩm */
        .product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.12) !important;
        }
        
        /* Đảm bảo text trên nút không bị xuống dòng khi màn hình nhỏ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }

        /* Hiệu ứng khi hover vào nút con mắt */
        .btn-light:hover {
            background-color: #e9ecef;
            color: var(--primary-red);
        }

        /* Footer */
        .main-footer {
            background: white;
            border-top: 3px solid var(--primary-red);
            padding-top: 50px;
            margin-top: 60px;
        }
        .footer-title {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 20px;
            text-transform: uppercase;
        }
        .footer-links { list-style: none; padding: 0; }
        .footer-links li { margin-bottom: 10px; }
        .footer-links a {
            color: #555;
            text-decoration: none;
            font-size: 0.9rem;
            transition: 0.2s;
        }
        .footer-links a:hover { color: var(--primary-red); padding-left: 5px; }
        .social-icons a {
            display: inline-flex;
            width: 35px;
            height: 35px;
            background: #eee;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            color: #333;
            margin-right: 10px;
            transition: 0.3s;
            text-decoration: none;
        }
        .social-icons a:hover { background: var(--primary-red); color: white; }
        .copyright {
            background: #f1f1f1;
            padding: 20px 0;
            font-size: 0.85rem;
            color: #777;
            margin-top: 40px;
        }
    </style>
</head>
<body>

<!-- APPBAR -->
<nav class="navbar navbar-expand-lg sticky-top shadow-sm">
    <div class="container">
        <!-- Logo -->
        <a class="navbar-brand fw-bold fs-2" th:href="@{/user/home}">
            <i class="fa-solid fa-mobile-retro me-2"></i>PHONE<span>SHOP</span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <!-- TÌM KIẾM -->
            <div class="mx-auto my-2 my-lg-0 search-container">
                <!-- Thêm th:action dẫn về trang home -->
                <form th:action="@{/user/home}" method="get">
                    <input type="text" name="keyword" th:value="${keyword}" class="form-control search-input" 
                        placeholder="Bạn tìm điện thoại gì...">
                    <button class="search-btn-inside" type="submit">
                        <i class="fa fa-search small"></i>
                    </button>
                </form>
            </div>

            <!-- Actions -->
            <div class="navbar-nav align-items-center gap-2">
                <a class="btn btn-primary px-3 position-relative" th:href="@{/user/cart}">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span th:if="${session.totalItems != null && session.totalItems > 0}" 
                          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark"
                          th:text="${session.totalItems}">0</span>
                </a>
                
                <!-- Nếu chưa đăng nhập -->
                <th:block th:if="${session.loggedInUser == null}">
                    <a class="btn btn-outline-primary btn-sm px-3" th:href="@{/user/login}">
                        <i class="fa-solid fa-arrow-right-to-bracket px-1"></i>Đăng nhập
                    </a>
                    <a class="btn btn-primary btn-sm px-3" th:href="@{/user/register}">
                        <i class="fa-solid fa-user-plus px-1"></i>Đăng ký
                    </a>
                </th:block>
                
                <!-- Nếu đã đăng nhập -->
                <th:block th:if="${session.loggedInUser != null}">
                    <div class="dropdown">
                        <button class="btn btn-outline-primary btn-sm px-3 dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-user me-1"></i>
                            <span th:text="${session.loggedInUser.fullName}">Tên người dùng</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="fa-solid fa-user me-2"></i>Tài khoản</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fa-solid fa-box me-2"></i>Đơn hàng</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" th:href="@{/user/logout}"><i class="fa-solid fa-right-from-bracket me-2"></i>Đăng xuất</a></li>
                        </ul>
                    </div>
                </th:block>
            </div>
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="container mt-5">
    
    <!-- BRAND LIST -->
    <div class="mb-5">
        <div class="d-flex align-items-center mb-4">
            <div style="width: 5px; height: 25px; background: var(--primary-red); margin-right: 10px;"></div>
            <h4 class="fw-bold mb-0 text-uppercase">Thương hiệu chính hãng</h4>
        </div>
        
        <div class="row g-3">
            <!-- Lặp danh mục -->
            <div th:each="cat : ${listCategory}" class="col-4 col-md-2">
                <!-- THÊM THẺ A VÀO ĐÂY -->
                <a th:href="@{/user/home(cid=${cat.categoryID}, sort=${currentSort})}" class="text-decoration-none">
                    <div class="brand-card shadow-sm">
                        <img th:src="@{/uploads/brands/{img}(img=${cat.logoImage})}" alt="Brand Logo">
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- PRODUCT LIST -->
    <div class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <div class="d-flex align-items-center">
                    <div style="width: 5px; height: 25px; background: var(--primary-red); margin-right: 10px;"></div>
                    <h4 class="fw-bold mb-0 text-uppercase">Gợi ý cho bạn</h4>
                </div>
            </div>
            
            <!-- Dropdown sắp xếp -->
            <div class="d-flex align-items-center gap-3">
                <form id="sortForm" th:action="@{/user/home}" method="get" class="d-flex align-items-center gap-2">
                    <!-- Giữ lại các filter hiện tại -->
                    <input type="hidden" name="cid" th:value="${currentCid}" th:if="${currentCid != null}">
                    <input type="hidden" name="keyword" th:value="${currentKeyword}" th:if="${currentKeyword != null and !currentKeyword.isEmpty()}">
                    
                    <label class="text-muted small fw-semibold mb-0">Sắp xếp:</label>
                    <select name="sort" class="form-select form-select-sm" style="width: auto;" onchange="this.form.submit()">
                        <option value="default" th:selected="${currentSort == 'default' or currentSort == null}">Mặc định</option>
                        <option value="price-asc" th:selected="${currentSort == 'price-asc'}">Giá: Thấp → Cao</option>
                        <option value="price-desc" th:selected="${currentSort == 'price-desc'}">Giá: Cao → Thấp</option>
                        <option value="name-asc" th:selected="${currentSort == 'name-asc'}">Tên: A → Z</option>
                        <option value="name-desc" th:selected="${currentSort == 'name-desc'}">Tên: Z → A</option>
                        <option value="newest" th:selected="${currentSort == 'newest'}">Mới nhất</option>
                    </select>
                </form>
                
                <a th:href="@{/user/home}" class="text-danger text-decoration-none fw-bold">
                    Xem tất cả <i class="fa-solid fa-chevron-right ms-1"></i>
                </a>
            </div>
        </div>
        
        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
            <div class="col" th:each="p : ${listProduct}">
                <div class="card h-100 shadow-sm border-0 rounded-4 product-card">
                    <!-- Phần ảnh -->
                    <div class="position-relative">
                        <img th:src="@{/uploads/products/{img}(img=${p.baseImage})}" 
                            class="card-img-top p-4" alt="Product" 
                            style="height: 220px; object-fit: contain;">
                    </div>

                    <!-- Phần nội dung -->
                    <div class="card-body d-flex flex-column p-3">
                        <h6 class="card-title fw-bold text-dark mb-1 text-truncate" 
                            th:text="${p.productName}" th:title="${p.productName}">
                            Tên sản phẩm
                        </h6>
                        
                        <div class="mb-3">
                            <span class="small text-success bg-success bg-opacity-10 px-2 py-1 rounded-2 fw-semibold">
                                <i class="fa-solid fa-gift me-1"></i>Trả góp 0% - kỳ hạn đến 12 tháng 
                            </span>
                        </div>

                        <div class="mt-auto">
                            <div class="mb-3">
                                <span class="text-danger fw-bold fs-5"
                                    th:text="${#numbers.formatDecimal(p.price, 0, 'POINT', 0, 'COMMA')} + ' ₫'">
                                    24.890.000 ₫
                                </span>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <form th:action="@{/user/cart/add/{id}(id=${p.productID})}" method="post" class="flex-grow-1">
                                    <input type="hidden" name="quantity" value="1">
                                    <button type="submit" class="btn btn-danger fw-semibold rounded-3 shadow-sm w-100 d-flex align-items-center justify-content-center" style="white-space: nowrap;">
                                        <i class="fa-solid fa-cart-shopping me-2"></i>Thêm vào giỏ
                                    </button>
                                </form>
                                
                                <a th:href="@{/user/product/{id}(id=${p.productID})}" 
                                class="btn btn-outline-secondary rounded-3 d-flex align-items-center justify-content-center" 
                                style="width: 42px; height: 42px; text-decoration: none;">
                                    <i class="fa-solid fa-eye"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Không có sản phẩm -->
        <div class="text-center py-5" th:if="${#lists.isEmpty(listProduct)}">
            <img src="https://cdn-icons-png.flaticon.com/512/6134/6134065.png" style="width: 100px; opacity: 0.5;">
            <h5 class="mt-3 text-muted">Không có kết quả bạn tìm kiếm</h5>
            <a th:href="@{/user/home}" class="btn btn-outline-danger mt-2">Xem tất cả sản phẩm</a>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer class="main-footer">
    <div class="container">
        <div class="row g-4">
            <!-- Cột 1 -->
            <div class="col-lg-3 col-md-6">
                <div class="footer-title">PhoneShop</div>
                <div class="mb-3">
                    <small class="text-muted d-block">Cam kết hàng chính hãng 100% – Hoàn tiền nếu phát hiện hàng giả.</small>
                </div>
                <p class="small text-muted mb-2"><i class="fa-solid fa-envelope me-2"></i> support@phoneshop.vn</p>
                <p class="small text-muted mb-2">Hotline hỗ trợ: 2121212121</p>
                
            </div>

            <!-- Cột 2 -->
            <div class="col-lg-3 col-md-6">
                <div class="footer-title">Thông tin chính sách</div>
                <ul class="footer-links">
                    <li><a href="#">Mua hàng và thanh toán Online</a></li>
                    <li><a href="#">Chính sách bảo hành chính hãng</a></li>
                    <li><a href="#">Chính sách đổi trả sản phẩm</a></li>
                    <li><a href="#">Chính sách vận chuyển</a></li>
                </ul>
            </div>

            <!-- Cột 3 -->
            <div class="col-lg-3 col-md-6">
                <div class="footer-title">Dịch vụ & Tiện ích</div>
                <ul class="footer-links">
                    <li><a href="#">Mua hàng trả góp 0%</a></li>
                    <li><a href="#">Tra cứu hóa đơn điện tử</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Dịch vụ bảo hành mở rộng</a></li>
                </ul>
            </div>

            <!-- Cột 4 -->
            <div class="col-lg-3 col-md-6">
                <div class="footer-title">Liên hệ với chúng tôi</div>
                <div class="social-icons mt-4">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                    <a href="#"><i class="fab fa-tiktok"></i></a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="copyright text-center">
        <div class="container">
            &copy; 2026 PhoneShop.
        </div>
    </div>
</footer>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>